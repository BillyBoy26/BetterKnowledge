<!DOCTYPE html>
<html lang="en">

<head>



    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap-3.3.6/dist/css/bootstrap.css" rel="stylesheet">

    <title>BetterKnowledge homepage</title>

    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
     HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

    <![endif]-->
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-md5.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha1.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha256.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/hmac-sha512.js"></script>

</head>

<div class="container mainContent">
    <section class="row" >
        <h1 class="col-lg-12">
            Bienvenu sur BetterKnowledge
        </h1>

    </section>
</div>
<p>

</p>



<!-- 1. The Gruveo embed's <iframe> will replace this <div> tag. -->
<div id="myembed"></div>

<script>
    // 2. This code loads the Gruveo Embed API code asynchronously.
    var tag = document.createElement("script");
    tag.src = "https://www.gruveo.com/embed-api/";
    var firstScriptTag = document.getElementsByTagName("script")[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


    console.log('initEmbed');
    // 3. This function gets called after the API code downloads. It creates
    //    the actual Gruveo embed (the <iframe>) and wires up the event
    //    handlers.
    var embed;
    function onGruveoEmbedAPIReady() {
        console.log('onGruveoEmbedAPIReady');
        //TODO bouger de la et mettre une vrai cl√©
        var secret = 'YOUR_API_KEY';
        console.log(secret);
        var generated =  <%- JSON.stringify(generated) %>;
        console.log(generated);
        var hash = CryptoJS.HmacSHA256(generated, secret);
        console.log(hash);
        var signature = btoa(hash);
        console.log(hash);
        embed = new Gruveo.Embed("myembed", {
            width: 680,
            height: 465,
            embedParams: {
                generated: generated,
                signature: signature,
                color: "63b2de"
    }
    });

    embed
            .on("ready", onEmbedReady)
            .on("stateChange", onEmbedStateChange);
    }
    console.log('event listen');

    // 4. This function will get called by the API when the embed is ready.
    function onEmbedReady(e) {
        embed.call("mycode123", true);
    }

    // 5. The API will call this function when the embed's state changes.
    //    The function indicates that after a call is established
    //    (state == "call"), the embed should hang up after 10 seconds.
    function onEmbedStateChange(e) {
        if (e.state == "call") {
            setTimeout(endCall, 10000);
        }
    }
    function endCall() {
        embed.end();
    }
    console.log('end script');
</script>

<body >




</body>

</html>
